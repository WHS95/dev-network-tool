<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DevCurl Panel</title>
    <link rel="stylesheet" href="panel.css" />
  </head>
  <body>
    <div class="app-container">
      <!-- Top navigation bar -->
      <div class="top-nav">
        <div class="top-nav-tabs">
          <button class="top-nav-tab active" data-view="requests">
            Requests
          </button>
          <button class="top-nav-tab" data-view="screenmap">Screen Map</button>
        </div>
        <button class="scan-btn" id="scanBtn" title="현재 페이지 스캔">
          <span class="scan-icon">⊙</span> Scan
        </button>
      </div>

      <!-- ════════════════════════════════════════ -->
      <!-- VIEW: Requests (기존 v1.x 기능)          -->
      <!-- ════════════════════════════════════════ -->
      <div class="view-container" id="requestsView">
        <div class="panel-container">
          <!-- Compact mode toggle -->
          <button
            id="panelToggle"
            class="panel-toggle hidden"
            title="목록 토글"
          >
            ◀
          </button>

          <!-- Left panel: request list -->
          <div class="left-panel">
            <div class="filter-section">
              <!-- URL search -->
              <div class="search-box">
                <span class="search-icon">🔍</span>
                <input
                  type="text"
                  id="urlSearch"
                  placeholder="URL 검색..."
                  autocomplete="off"
                />
              </div>

              <div class="filter-buttons">
                <!-- Method filters -->
                <div class="filter-group" id="methodFilters">
                  <span class="filter-label">Method</span>
                  <button class="filter-btn active" data-method="ALL">
                    ALL
                  </button>
                  <button class="filter-btn" data-method="GET">GET</button>
                  <button class="filter-btn" data-method="POST">POST</button>
                  <button class="filter-btn" data-method="PUT">PUT</button>
                  <button class="filter-btn" data-method="DELETE">DEL</button>
                  <button class="filter-btn" data-method="PATCH">PATCH</button>
                </div>

                <!-- Status filters -->
                <div class="filter-group" id="statusFilters">
                  <span class="filter-label">Status</span>
                  <button class="filter-btn active" data-status="ALL">
                    ALL
                  </button>
                  <button class="filter-btn" data-status="2xx">2xx</button>
                  <button class="filter-btn" data-status="3xx">3xx</button>
                  <button class="filter-btn" data-status="4xx">4xx</button>
                  <button class="filter-btn" data-status="5xx">5xx</button>
                </div>
              </div>
            </div>

            <!-- Sort control -->
            <div class="sort-bar">
              <span class="sort-label">정렬</span>
              <button class="sort-btn active" id="sortNewest" data-sort="newest">최신순</button>
              <button class="sort-btn" id="sortOldest" data-sort="oldest">과거순</button>
            </div>

            <!-- Request list -->
            <div class="request-list-wrapper">
              <ul class="request-list" id="requestList" role="listbox"></ul>
            </div>

            <!-- Bottom actions -->
            <div class="bottom-actions">
              <button class="action-btn" id="clearBtn">🗑 초기화</button>
              <button class="action-btn" id="settingsBtn">⚙ 설정</button>
            </div>
          </div>

          <!-- Right panel: detail view -->
          <div class="right-panel">
            <div class="detail-view">
              <!-- Empty state -->
              <div id="emptyState" class="empty-state">
                <p>요청을 선택하세요</p>
                <p class="empty-hint">
                  좌측 목록에서 API 요청을 클릭하면<br />cURL, fetch, axios
                  코드를 확인할 수 있습니다
                </p>
              </div>

              <!-- Detail content -->
              <div id="detailContent" class="detail-content hidden">
                <!-- Response summary card -->
                <div class="response-summary-card">
                  <div class="status-row">
                    <span id="statusDot" class="status-dot"></span>
                    <span id="statusCode" class="status-code">—</span>
                    <span id="statusText" class="status-text">—</span>
                  </div>
                  <div class="meta-row">
                    <span class="meta-item" id="contentType">—</span>
                    <span class="meta-item" id="responseTime">—</span>
                  </div>
                </div>

                <!-- Format tabs -->
                <div class="detail-tabs">
                  <button class="detail-tab active" data-tab="curl">
                    cURL
                  </button>
                  <button class="detail-tab" data-tab="fetch">fetch</button>
                  <button class="detail-tab" data-tab="axios">axios</button>
                  <button class="detail-tab" data-tab="response">
                    Response
                  </button>
                </div>

                <!-- Code block (cURL / fetch / axios) -->
                <div id="codePanel" class="code-panel">
                  <div class="curl-block-wrapper">
                    <button class="copy-btn" id="copyBtn">Copy</button>
                    <pre class="curl-block"><code id="codeOutput"></code></pre>
                  </div>
                </div>

                <!-- Response panel -->
                <div id="responsePanel" class="response-panel hidden">
                  <!-- Response headers -->
                  <div class="response-section">
                    <button
                      class="response-section-toggle"
                      id="responseHeadersToggle"
                    >
                      <span class="toggle-icon">▶</span>
                      <span>Response Headers</span>
                      <span class="header-count" id="headerCount">0</span>
                    </button>
                    <div
                      id="responseHeaders"
                      class="response-headers collapsed"
                    >
                      <table class="headers-table">
                        <tbody id="responseHeadersBody"></tbody>
                      </table>
                    </div>
                  </div>

                  <!-- Response body -->
                  <div class="response-section">
                    <div class="response-body-header">
                      <span>Response Body</span>
                      <button class="copy-btn copy-btn-sm" id="copyResponseBtn">
                        Copy
                      </button>
                    </div>
                    <pre
                      class="response-body"
                    ><code id="responseBody"></code></pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ════════════════════════════════════════ -->
      <!-- VIEW: Screen Map (v2.0 신규)            -->
      <!-- ════════════════════════════════════════ -->
      <div class="view-container hidden" id="screenmapView">
        <div class="panel-container">
          <!-- Left panel: scanned pages list -->
          <div class="left-panel">
            <div class="filter-section">
              <div class="search-box">
                <span class="search-icon">🔍</span>
                <input
                  type="text"
                  id="pageSearch"
                  placeholder="페이지 검색..."
                  autocomplete="off"
                />
              </div>
            </div>

            <div class="request-list-wrapper">
              <ul class="request-list" id="pageList" role="listbox"></ul>
            </div>

            <div class="bottom-actions">
              <button class="action-btn" id="clearScansBtn">🗑 초기화</button>
              <button class="action-btn" id="exportBtn">📤 Export</button>
            </div>
          </div>

          <!-- Right panel: page detail -->
          <div class="right-panel">
            <div class="detail-view">
              <!-- Empty state -->
              <div id="screenMapEmpty" class="empty-state">
                <p>스캔된 페이지가 없습니다</p>
                <p class="empty-hint">
                  앱 페이지에서 우측 상단의<br /><strong>Scan</strong> 버튼을
                  눌러 시작하세요
                </p>
              </div>

              <!-- Page detail -->
              <div id="screenMapDetail" class="screen-map-detail hidden">
                <!-- Page info card -->
                <div class="response-summary-card">
                  <div class="sm-page-info">
                    <div class="sm-info-row">
                      <span class="sm-label">Route</span>
                      <span class="sm-value" id="smRoute">—</span>
                    </div>
                    <div class="sm-info-row">
                      <span class="sm-label">URL</span>
                      <span class="sm-value mono" id="smUrl">—</span>
                    </div>
                    <div class="sm-info-row">
                      <span class="sm-label">Framework</span>
                      <span class="sm-value" id="smFramework">—</span>
                    </div>
                    <div class="sm-info-row">
                      <span class="sm-label">Scanned</span>
                      <span class="sm-value" id="smScannedAt">—</span>
                    </div>
                  </div>
                </div>

                <!-- API list -->
                <div class="sm-section">
                  <div class="sm-section-title">
                    <span>📡 API 호출</span>
                    <span class="sm-count" id="smApiCount">0</span>
                  </div>
                  <div id="smApiList" class="sm-api-list"></div>
                </div>

                <!-- Linked pages -->
                <div class="sm-section">
                  <div class="sm-section-title">
                    <span>🔗 연결된 페이지</span>
                    <span class="sm-count" id="smLinkCount">0</span>
                  </div>
                  <div id="smLinkList" class="sm-link-list"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="../lib/header-filter.js"></script>
    <script src="../lib/curl-generator.js"></script>
    <script src="../lib/code-generator.js"></script>
    <script src="../lib/screen-scanner.js"></script>
    <script src="panel.js"></script>
  </body>
</html>
